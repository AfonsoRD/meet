{"ast":null,"code":"import axios from 'axios';\nimport { mockData } from './mock-data';\nimport NProgress from 'nprogress';\nexport const getAccessToken = async () => {\n  const accessToken = localStorage.getItem('access_token');\n  const tokenCheck = accessToken && (await checkToken(accessToken));\n  if (!accessToken || tokenCheck.error) {\n    await localStorage.removeItem('access_token');\n    const searchParams = new URLSearchParams(window.location.search);\n    const code = await searchParams.get('code');\n    if (!code) {\n      const results = await axios.get('https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/get-auth-url');\n      const {\n        authUrl\n      } = results.data;\n      return window.location.href = authUrl;\n    }\n    return code && getToken(code);\n  }\n  return accessToken;\n};\nconst checkToken = async accessToken => {\n  const result = await fetch(`https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`).then(res => res.json()).catch(error => error.json());\n  return result;\n};\nexport const getEvents = async () => {\n  NProgress.start();\n  if (window.location.href.startsWith('http://localhost')) {\n    NProgress.done();\n    return mockData;\n  }\n  const token = await getAccessToken();\n  if (token) {\n    removeQuery();\n    const url = 'https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/get-events' + '/' + token;\n    const result = await axios.get(url);\n    if (result.data) {\n      var locations = extractLocations(result.data.events);\n      localStorage.setItem('lastEvents', JSON.stringify(result.data));\n      localStorage.setItem('locations', JSON.stringify(locations));\n    }\n    NProgress.done();\n    return result.data.events;\n  }\n};\nexport const extractLocations = events => {\n  var extractLocations = events.map(event => event.location);\n  var locations = [...new Set(extractLocations)];\n  return locations;\n};\nconst removeQuery = () => {\n  if (window.history.pushState && window.location.pathname) {\n    var newurl = window.location.protocol + '//' + window.location.host + window.location.pathname;\n    window.history.pushState('', '', newurl);\n  } else {\n    newurl = window.location.protocol + '//' + window.location.host;\n    window.history.pushState('', '', newurl);\n  }\n};\nconst getToken = async code => {\n  const encodeCode = encodeURIComponent(code);\n  const {\n    access_token\n  } = await fetch('https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/token' + '/' + encodeCode).then(res => {\n    return res.json();\n  }).catch(error => error);\n  access_token && localStorage.setItem('access_token', access_token);\n  return access_token;\n};","map":{"version":3,"names":["axios","mockData","NProgress","getAccessToken","accessToken","localStorage","getItem","tokenCheck","checkToken","error","removeItem","searchParams","URLSearchParams","window","location","search","code","get","results","authUrl","data","href","getToken","result","fetch","then","res","json","catch","getEvents","start","startsWith","done","token","removeQuery","url","locations","extractLocations","events","setItem","JSON","stringify","map","event","Set","history","pushState","pathname","newurl","protocol","host","encodeCode","encodeURIComponent","access_token"],"sources":["/Users/ruiafonso/Desktop/CF Front end/TASK 4/meet/src/api.js"],"sourcesContent":["import axios from 'axios';\nimport { mockData } from './mock-data';\nimport NProgress from 'nprogress';\n\nexport const getAccessToken = async () => {\n  const accessToken = localStorage.getItem('access_token');\n\n  const tokenCheck = accessToken && (await checkToken(accessToken));\n\n  if (!accessToken || tokenCheck.error) {\n    await localStorage.removeItem('access_token');\n    const searchParams = new URLSearchParams(window.location.search);\n    const code = await searchParams.get('code');\n    if (!code) {\n      const results = await axios.get(\n        'https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/get-auth-url'\n      );\n      const { authUrl } = results.data;\n      return (window.location.href = authUrl);\n    }\n    return code && getToken(code);\n  }\n  return accessToken;\n};\n\nconst checkToken = async (accessToken) => {\n  const result = await fetch(\n    `https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`\n  )\n    .then((res) => res.json())\n    .catch((error) => error.json());\n\n  return result;\n};\n\nexport const getEvents = async () => {\n  NProgress.start();\n\n  if (window.location.href.startsWith('http://localhost')) {\n    NProgress.done();\n    return mockData;\n  }\n\n  const token = await getAccessToken();\n\n  if (token) {\n    removeQuery();\n    const url =\n      'https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/get-events' +\n      '/' +\n      token;\n    const result = await axios.get(url);\n    if (result.data) {\n      var locations = extractLocations(result.data.events);\n      localStorage.setItem('lastEvents', JSON.stringify(result.data));\n      localStorage.setItem('locations', JSON.stringify(locations));\n    }\n    NProgress.done();\n    return result.data.events;\n  }\n};\n\nexport const extractLocations = (events) => {\n  var extractLocations = events.map((event) => event.location);\n  var locations = [...new Set(extractLocations)];\n  return locations;\n};\n\nconst removeQuery = () => {\n  if (window.history.pushState && window.location.pathname) {\n    var newurl =\n      window.location.protocol +\n      '//' +\n      window.location.host +\n      window.location.pathname;\n    window.history.pushState('', '', newurl);\n  } else {\n    newurl = window.location.protocol + '//' + window.location.host;\n    window.history.pushState('', '', newurl);\n  }\n};\n\nconst getToken = async (code) => {\n  const encodeCode = encodeURIComponent(code);\n  const { access_token } = await fetch(\n    'https://zws2z8vkw6.execute-api.eu-central-1.amazonaws.com/dev/api/token' +\n      '/' +\n      encodeCode\n  )\n    .then((res) => {\n      return res.json();\n    })\n    .catch((error) => error);\n\n  access_token && localStorage.setItem('access_token', access_token);\n\n  return access_token;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}